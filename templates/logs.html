{% extends "base.html" %}

{% block content %}

<div class="row">
  <div class="columns">
    <h1 class="section-title">Logs</h1>
  </div>
</div>

<div class="row">
    <div class="large-9 medium-9 small-6 columns">
        <a class="button button-primary" id="APIstart" onclick="refreshForMsg('{{ url_for('APIstart') }}')">Start Robot API</a>
        <a class="button button-primary" id="APIreset" onclick="refreshForMsg('{{ url_for('APIreset') }}')">Reboot Robot API</a>
        <a class="button button-primary" id="APIstop" onclick="refreshForMsg('{{ url_for('APIstop') }}')">Stop Robot API</a>
    </div>
    <div class="large-3 medium-3 small-3 columns" align="right">
          <h4>
            Toggle camera
          </h4>
          <div class="switch il">
            <input class="switch-input" id="camera-switch" type="checkbox" name="camera-switch" onclick="refreshForMsg('{{ url_for('switch_camera') }}')" {% if robot.camera %} checked{% endif %}>
            <label class="switch-paddle" for="camera-switch">
              <span class="show-for-sr">Toggle Camera</span>
            </label>
          </div>
        </div>
</div>

<div class="row">
  <div class="large-12 columns">
    <pre>
<a id="show-switch" style="visibility:hidden">show more</a>
<code style="max-height:145px;overflow-y:hidden;" id="robot-logs" class="accesslog hljs">{{ logs_content }}</code>
    </pre>
  </div>
</div>

{% endblock content %}

{% block endscript %}
<script>
var timeOut;
var logsElement = document.getElementById('robot-logs');
var showSwitch = document.getElementById('show-switch');

$('#show-switch').click(function() {
    if (showSwitch.innerHTML === "show more") {
        logsElement.style.maxHeight = "none";
        logsElement.style.overflow-y = "auto";
        showSwitch.innerHTML = "show less";
    } else {
        logsElement.style.maxHeight = "145px";
        logsElement.style.overflow-y = "hidden";
        showSwitch.innerHTML = "show more";
    };
});

function refreshLogs() {

  if (logsElement.scrollHeight < 145) {
      showSwitch.style.visibility = "hidden";
  } else {
      showSwitch.style.visibility = "visible";
  };

  $.get('{{ url_for('raw_logs') }}', function(rawLogs) {
    logsElement.innerHTML = rawLogs;
    logsElement.scrollTop = logsElement.scrollHeight;
    hljs.highlightBlock(logsElement);

    startTimeout();
  });
}

function startTimeout() {
  timeOut = window.setTimeout(refreshLogs, 500);
}

startTimeout();

</script>
{% endblock endscript %}
